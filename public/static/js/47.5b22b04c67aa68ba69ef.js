webpackJsonp([47],{147:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e(31),i=e.n(a);s.default={data:function(){return{isVideo:!1,user:{},doctors:{},lists:[],swiper:"",statusOrder:!0,recipe_photo:""}},filters:{voice:function(t){return t?webim.voiceUrl+t:""},duration:function(t){return t?t+"〃":""}},mounted:function(){var t=localStorage.getItem("imToken");this.getChatStatus(this.$route.query.listId,this.$route.query.bespeakId);var s={},e=this.$route.query.doctorName;if(console.log("location.hostname="+location.hostname),"localhost"==location.hostname||"tcm.app"==location.hostname)s.user={uid:"1",img:"http://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICbm0lbbaHY5R05D0nk4LHp9tdkZfcty2ibicsCNJOUtGehYZ7RfibPHytIheicghCiaQsSwzp1sibpewA/0"},s.list_id=1,s.doctor={uid:"1",img:"https://lorempixel.com/640/480/?50410"},s.token="20171228151944047171";else{if(!t||!this.$route.query.listId)return $api.pop("缺失参数 : token:"+t+" listId:"+this.$route.query.listId+"doctorName:"+this.$route.query.doctorName),!1;s.list_id=this.$route.query.listId,e=this.$route.query.doctorName,s.token=t}$("#nick").text(e),console.log(e+t),console.log("params="+i()(s));var a=this;zpChat.init(a,s,function(){zpChat.initWs(function(t,s){switch(t){case"getChatUser":console.log("getChatUser:"+i()(s)),zpChat.user=s.user,zpChat.doctor=s.doctor,zpChat.clinicId=s.clinicId;var e=a.lists.length;0==e?zpChat.getLatestMessages():zpChat.getSyncMsg(a);break;case"syncMsg":zpChat.returnHtml(s,a,"new",function(){zpChat.is_sync=!1,zpChat.getSyncMsg(a)}),$("body").hasClass("loading")&&$("body").removeClass("loading"),setTimeout(function(){a.swiper.update();var t=a.swiper.height,s=a.swiper.virtualSize;a.swiper.setWrapperTranslate(t-s)},400);break;case"oneMsg":zpChat.getSyncMsg(a);break;case"history":console.log("history:"+i()(s)),zpChat.isLoading=!1;var e=a.lists.length,n="old";0==e&&(n="new"),zpChat.returnHtml(s,a,n),"new"==n&&setTimeout(function(){a.swiper.update();var t=a.swiper.height,s=a.swiper.virtualSize;a.swiper.setWrapperTranslate(t-s)},400),setTimeout(function(){o.hide()},1e3),$("body").hasClass("loading")&&$("body").removeClass("loading");break;case"showBtn":var r=s.show;switch(zpChat.showBtnStatus=r,parseInt(r)){case 1:zpChat.showBtn_1();break;case 2:zpChat.showBtn_2();break;case 3:case 5:zpChat.showBtn_3(r)}var c=s.isSend;isEmpty(c)||(zpChat.sendTextMessage({text:"患者结束诊疗",type:3},function(t){}),setTimeout(function(){a.swiper.update();var t=a.swiper.height,s=a.swiper.virtualSize;a.swiper.setWrapperTranslate(t-s)},400))}})});var n=this;$("footer.foot_inp textarea").on("focus",function(){setTimeout(function(){n.swiper.update();var t=n.swiper.height,s=n.swiper.virtualSize;n.swiper.setWrapperTranslate(t-s)},400)}),/iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase())&&($("footer.foot_inp textarea").on("focus",function(){setTimeout(function(){n.swiper.update();var t=n.swiper.height,s=n.swiper.virtualSize;n.swiper.setWrapperTranslate(t-s);var e=$("body").height()-t-$("header").height()-$(".aglinC").height()-$(".fs").height(),a=$("body").height()-t-$("header").height()-$(".aglinC").height()/2;$(".fs").css({position:"absolute",bottom:e}),$(".aglinC").css({position:"absolute",bottom:a})},400)}),$("footer.foot_inp textarea").on("blur",function(){$(".fs").css({position:"fixed",bottom:0}),$(".aglinC").css({position:"fixed",bottom:"0.85rem"})})),window.addEventListener("resize",function(){"INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName||window.setTimeout(function(){document.activeElement.scrollIntoViewIfNeeded()},0)});var o=$(".chat_body").find(".visible");setTimeout(function(){n.swiper=new Swiper(".swiper-container-list",{direction:"vertical",slidesPerView:"auto",observer:!0,observeParents:!0,mousewheelControl:!0,freeMode:!0,resistanceRatio:.7,onTouchEnd:function(t){t.height,t.virtualSize;if(t.translate>0){if(o.show(),n.statusOrder){var s=zpChat.getStorage();if(!isEmpty(s))return $api.pop("网络信号不好，请稍后再试"),!1;$(".visible").html("正在加载..."),$(".tips").hasClass("none")||$(".tips").addClass("none");var e=isEmpty(a.lists[0])?{}:n.lists[0];isEmpty(e.messageId)||zpChat.getHistoryMessages(e.messageId),setTimeout(function(){t.update()},800)}}else 0==t.translate&&o.hide()}})},400),window.addEventListener("popstate",function(t){$("textarea").blur()},!1),$("footer.foot_inp .btn").click(function(){if(!zpChat.isSendMsg)return $api.pop(zpChat.isSendMsgTip),!1;var t=$("footer.foot_inp textarea").val();if($api.isEmpty(t))$api.pop("没有输入内容");else{var s=zpChat.getStorage();if(!isEmpty(s))return $api.pop("网络信号不好，请稍后再试"),!1;zpChat.sendTextMessage({text:t},function(t){$("footer.foot_inp textarea").val("")})}})},methods:{video:function(){console.log("params="+i()(zpChat)),LBBVideo.openCall("doctor"+zpChat.doctor.uid,zpChat.doctor.name,zpChat.doctor.img)},scare:function(t){$(t.currentTarget).parent(".imgBox").toggleClass("active")},rePay:function(){this.$router.push({path:"/doctor/preOnline",query:{id:zpChat.toUser,subscribe_id:zpChat.subscribeId,subscribe_type:0}})},play:function(t){$(t.currentTarget).parent(".cont").children("audio")[0].play()},bg:function(t){if(t)return"background-image:url("+t+")"},sT:function(t){var s=this;return dateDiff(s.lists[t-1].time,s.lists[t].time)>.01},showCard:function(t){console.log("card:"+i()(this.lists[t]));var s=this.lists[t].extra;if(s.text,!1)return!1;this.lists[t].clinic_id;if(!isEmpty(s.cid)){var e=s.cType,a={},n="";switch(parseInt(e)){case 2:a={id:s.cid},n="/standard";break;case 1:case 4:n="/exam",a={id:s.id,clinic_id:s.clinic_id};break;case 3:n="/prescription/my/id",a={id:s.cid}}"/exam"==n?this.$store.state.tcmuser?this.$router.push({path:"/exam",query:{id:s.cid,listId:this.$route.query.listId,clinic_id:s.clinic_id}}):window.location.href="/wechat/exam?id="+s.cid+"&listId="+this.$route.query.listId+"&clinic_id="+s.clinic_id:this.$router.push({path:n,query:a})}},dateFormat:function(t){return new Date(t.replace(/-/g,"/")).Format("yyyy-MM-dd hh:mm:ss")},zw:function(){$(".jswz").addClass("none"),$(".fz").removeClass("none"),this.$http.get(this.$store.state.apiUrl+"message/statusBar/"+this.$route.query.listId+"?is_ask=1").then(function(t){}),zpChat.zw(),this.swiper.update(),this.$http.put(this.$store.state.apiUrl+"message/ask/"+this.$route.query.listId).then(function(t){t.data.status?($(".zw").addClass("none"),$(".foot_inp.fs").removeClass("none"),$(".inputImg").removeClass("none"),$(".jszw").removeClass("none")):$api.pop(t.data.msg)})},fz:function(){zpChat.fz(),this.swiper.update(),this.$router.push({path:"/doctor/preOnline",query:{id:zpChat.doctor.uid}})},fq:function(){zpChat.cancelPay(),this.swiper.update()},js:function(){$(".layer_pop").removeClass("none")},jszw:function(){$(".layer_pop").removeClass("none")},confirm:function(){if(!$(".jswz").hasClass("none")){var t=this;zpChat.endSick(),t.swiper.update(),$(".layer_pop").addClass("none"),this.$http({url:this.$store.state.apiUrl+"message/closeClinic/"+this.$route.query.listId,method:"put"}).then(function(s){$api.pop(s.data.msg),s.data.status?(zpChat.endSick(),t.swiper.update(),$(".layer_pop").addClass("none"),t.getChatStatus(t.$route.query.listId,t.$route.query.bespeakId),t.$router.push({path:"/order"})):$api.pop(s.data.msg)})}if(!$(".jszw").hasClass("none")){var t=this;zpChat.endSick(),t.swiper.update(),$(".layer_pop").addClass("none"),this.$http.post(this.$store.state.apiUrl+"message/endAsk",{id:this.$route.query.listId}).then(function(s){$api.pop(s.data.msg),s.data.status?(t.swiper.update(),$(".layer_pop").addClass("none"),t.getChatStatus(t.$route.query.listId,t.$route.query.bespeakId),t.$router.push({path:"/order"})):$api.pop(s.data.msg)})}},close:function(){this.swiper.update(),$(".layer_pop").addClass("none")},pay:function(){this.$http({url:this.$store.state.apiUrl+"clinic/again",method:"GET",params:{id:zpChat.clinicId,type:"clinic"}}).then(function(t){t.data.status?(zpChat.showBtn_1(),setTimeout(function(){this.$store.state.tcmuser?this.$router.push({path:"/payment",query:{id:t.data.data.order_sn,type:0}}):window.location.href="/wechat/payment/?id="+t.data.data.order_sn+"&type=0"},2e3)):$api.pop(t.data.msg)})},goOrder:function(){this.$router.push({path:"/order"})},imgScare:function(t){this.recipe_photo=t,$(".imgScare").show()},closeImg:function(){$(".imgScare").hide()},appUpload:function(){if(this.$store.state.tcmuser){var t=zpChat.getStorage();if(!isEmpty(t))return $api.pop("网络信号不好，请稍后再试"),!1;if(!zpChat.isSendMsg)return $api.pop(zpChat.isSendMsgTip),!1;var s=this;AppUpload(function(t){t&&t.status?zpChat.sendImgMessage({key:t.data.image_thumb_url,hash:t.data.image_url},function(t){setTimeout(function(){s.swiper.update();var t=s.swiper.height,e=s.swiper.virtualSize;s.swiper.setWrapperTranslate(t-e)},400)}):$api.pop("上传失败")},"upload/qiniu")}},upload:function(t){var s=zpChat.getStorage();if(!isEmpty(s))return $api.pop("网络信号不好，请稍后再试"),!1;if(!zpChat.isSendMsg)return $api.pop(zpChat.isSendMsgTip),!1;$("body").addClass("loading");var e=t.target;console.log(e);var a=new FormData;a.append("upload",1),a.append("image",e.files[0]);var i=this;this.$http.post(this.$store.state.apiUrl+"upload/qiniu",a).then(function(t){if(console.log(t),t.status){var s=t.data;console.log(s),s.status?zpChat.sendImgMessage({key:s.data.image_thumb_url,hash:s.data.image_url},function(t){setTimeout(function(){i.swiper.update();var t=i.swiper.height,s=i.swiper.virtualSize;i.swiper.setWrapperTranslate(t-s)},400)}):alert(s.msg),$("body").removeClass("loading")}})},getChatStatus:function(t,s){this.$http.get(this.$store.state.apiUrl+"message/statusBar/"+t+"?is_ask=0&bespeakId="+s).then(function(t){t.data.data.clinic?$(".jswz").removeClass("none"):$(".jswz").addClass("none"),1==t.data.data.ask?$(".zw").removeClass("none"):$(".zw").addClass("none"),1==t.data.data.end?$(".jszw").addClass("none"):2==t.data.data.end&&$(".jszw").removeClass("none"),t.data.data.clinic||!t.data.data.ask&&2==t.data.data.end?($("#inputImg").removeClass("none"),t.data.data.isVideo&&(this.isVideo=!0)):t.data.data.clinic||t.data.data.ask||1!=t.data.data.end?t.data.data.ask&&!t.data.data.clinic&&($("#inputImg").addClass("none"),this.isVideo=!1):($("#inputImg").addClass("none"),this.isVideo=!1),t.data.data.visit?$(".fz").removeClass("none"):$(".fz").addClass("none"),t.data.data.keyboard?$(".foot_inp.fs").removeClass("none"):$(".foot_inp.fs").addClass("none")},function(t){errorMsg(t.data.data.errors)})}}}},235:function(t,s){t.exports={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{attrs:{id:"wrap"}},[e("header",[e("div",{staticClass:"left",on:{click:function(s){t.goOrder()}}},[e("i",{staticClass:"icon-arrow-left"})]),e("div",{staticClass:"center",attrs:{id:"nick"}},[t._v("某某某")])]),t._m(0),e("footer",{staticClass:"foot_inp aglinC active setFontSize liaotian"},[e("span",{staticClass:"inputImg",attrs:{id:"inputImg"},on:{click:t.appUpload}},[t.$store.state.tcmuser?t._e():e("input",{attrs:{type:"file",accept:"image/png,image/jpg"},on:{change:function(s){t.upload(s)}}}),t._m(1)]),t.isVideo&&t.$store.state.tcmuser?e("span",{staticClass:"inputImg",on:{click:t.video}},[t._m(2)]):t._e(),e("span",{staticClass:"zw none",on:{click:function(s){t.zw()}}},[t._v("追问")]),e("span",{staticClass:"fz none",on:{click:function(s){t.fz()}}},[t._v("复诊")]),e("span",{staticClass:"jswz none",on:{click:function(s){t.js()}}},[t._v("结束问诊")]),e("span",{staticClass:"jszw none",on:{click:function(s){t.jszw()}}},[t._v("结束追问")])]),e("div",{staticClass:"btn btn-fix active"},[e("div",{staticClass:"left",on:{click:function(s){t.fq()}}},[e("span",[t._v("放弃")])]),e("div",{staticClass:"right buy",on:{click:function(s){t.pay()}}},[t._v(" 立即支付")])]),t._m(3),e("div",{staticClass:"swiper-container swiper-container-list"},[e("div",{staticClass:"chat_body swiper-wrapper"},[e("div",{staticClass:"swiper-slide"},[e("div",{staticClass:"visible"},[t._v("下拉加载")]),t._l(t.lists,function(s,a){return e("div",{staticClass:"chat_li",attrs:{messagesId:s.messageId}},[1==s.timeShow?e("div",{staticClass:"time"},[t._v(" "+t._s(s.time))]):t._e(),"cen"==s.from?e("div",{staticClass:"time js"},[t._v(t._s(s.extra.text))]):e("div",{staticClass:"msg",class:s.from?"self":""},[s.img?e("div",{staticClass:"avatar",style:t.bg(s.img)}):e("div",{staticClass:"avatar",style:t.bg("/img/doctor_default.png")}),"image"==s.msg_type?e("div",{staticClass:"imgBox"},[e("img",{staticClass:"imgShow",attrs:{src:s.extra.key},on:{click:function(e){t.imgScare(s.extra.key)}}})]):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:"card"==s.msg_type,expression:"item.msg_type=='card'"}],staticClass:"cont bor link",on:{click:function(s){t.showCard(a)}}},[e("h3",[e("i",{staticClass:"icon-help"}),e("span",[t._v(t._s(s.extra.text))])]),e("p",[t._v(t._s(s.extra.con))]),e("p",{staticClass:"pCor"},[t._v(t._s(s.extra.recipe))]),"处方"==s.extra.text?e("p",[t._v(t._s(s.extra.textW))]):t._e(),t._m(4,!0),"处方"==s.extra.text&&8==s.extra.is_price?e("div",{staticClass:"cancel"},[t._m(5,!0)]):t._e()]),"text"==s.msg_type?e("div",{staticClass:"cont bor"},[e("p",{domProps:{innerHTML:t._s(s.extra.text)}})]):t._e(),"audio"==s.msg_type?e("div",{staticClass:"cont bor audioBox"},[e("div",{staticClass:"icon-rss",on:{click:function(s){t.play(s)}}}),e("audio",{staticClass:"audio",attrs:{src:t._f("voice")(s.extra.voicePath)}})]):t._e(),"audio"==s.msg_type?e("span",{staticClass:"second"},[t._v(t._s(t._f("duration")(s.extra.duration)))]):t._e()])])}),e("div",{staticClass:"chat_li min_h"},[e("div",{staticClass:"time js none"},[t._v("医生结束诊疗")]),t._m(6),e("div",{staticClass:"msg warningFz none"},[e("div",{staticClass:"cont bor warning"},[e("i",{staticClass:"icon-warning"}),e("span",[t._v("复诊需要重新下单支付")]),e("h5",{on:{click:t.rePay}},[e("span",[t._v("点击查看详情")]),e("i",{staticClass:"icon-arrow-right"})])])])])],2)])]),e("div",{staticClass:"layer_pop none"},[e("div",{staticClass:"content"},[e("div",{staticClass:"txt"},[t._v("您确定结束本次在线咨询？结束后将无法继续本次在线咨询服务。")]),e("div",{staticClass:"pop_btn clearfix"},[e("div",{staticClass:"p_btn l",on:{click:function(s){t.confirm()}}},[t._v("确定")]),e("div",{staticClass:"p_btn",on:{click:function(s){t.close()}}},[t._v("取消")])])])]),e("div",{staticClass:"pop popimg imgScare",on:{click:function(s){t.closeImg()}}},[e("img",{attrs:{src:t.recipe_photo}})])])},staticRenderFns:[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("footer",{staticClass:"foot_inp fs liaotiankuang"},[e("textarea",{attrs:{id:"sendText"}}),e("div",{staticClass:"btn btn-jv",attrs:{id:"send"}},[t._v("发送")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"icon"},[e("i")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"video"},[e("i")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"tips none"},[e("div",{staticClass:"icon-tit"},[e("i")]),e("span",[t._v("支付成功，开始咨询")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("h5",[e("span",[t._v("点击查看详情")]),e("i",{staticClass:"icon-arrow-right"})])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"cancelbg"},[e("span",[t._v("作废")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"msg warningTit none"},[e("div",{staticClass:"cont bor warning"},[e("i",{staticClass:"icon-warning"}),e("span",{attrs:{id:"zpTips"}})])])}]}},96:function(t,s,e){var a=e(11)(e(147),e(235),null,null);t.exports=a.exports}});