webpackJsonp([47],{148:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(32),i=a.n(s);e.default={data:function(){return{isVideo:!1,user:{},doctors:{},lists:[],swiper:"",statusOrder:!0,recipe_photo:""}},filters:{voice:function(t){return t?webim.voiceUrl+t:""},duration:function(t){return t?t+"〃":""}},mounted:function(){var t=localStorage.getItem("imToken");this.getChatStatus(this.$route.query.listId,this.$route.query.bespeakId);var e={},a=this.$route.query.doctorName;if(console.log("location.hostname="+location.hostname),"localhost"==location.hostname||"tcm.app"==location.hostname)e.user={uid:"1",img:"http://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICbm0lbbaHY5R05D0nk4LHp9tdkZfcty2ibicsCNJOUtGehYZ7RfibPHytIheicghCiaQsSwzp1sibpewA/0"},e.list_id=1,e.doctor={uid:"1",img:"https://lorempixel.com/640/480/?50410"},e.token="20171228151944047171";else{if(!t||!this.$route.query.listId)return $api.pop("缺失参数 : token:"+t+" listId:"+this.$route.query.listId+"doctorName:"+this.$route.query.doctorName),!1;e.list_id=this.$route.query.listId,a=this.$route.query.doctorName,e.token=t}$("#nick").text(a),console.log(a+t),console.log("params="+i()(e));var s=this;zpChat.init(s,e,function(){zpChat.initWs(function(t,e){switch(t){case"getChatUser":console.log("getChatUser:"+i()(e)),zpChat.user=e.user,zpChat.doctor=e.doctor,zpChat.clinicId=e.clinicId;var a=s.lists.length;0==a?zpChat.getLatestMessages():zpChat.getSyncMsg(s);break;case"syncMsg":zpChat.returnHtml(e,s,"new",function(){zpChat.is_sync=!1,zpChat.getSyncMsg(s)}),$("body").hasClass("loading")&&$("body").removeClass("loading"),setTimeout(function(){s.swiper.update();var t=s.swiper.height,e=s.swiper.virtualSize;s.swiper.setWrapperTranslate(t-e)},400);break;case"oneMsg":zpChat.getSyncMsg(s);break;case"history":console.log("history:"+i()(e)),zpChat.isLoading=!1;var a=s.lists.length,o="old";0==a&&(o="new"),zpChat.returnHtml(e,s,o),"new"==o&&setTimeout(function(){s.swiper.update();var t=s.swiper.height,e=s.swiper.virtualSize;s.swiper.setWrapperTranslate(t-e)},400),setTimeout(function(){n.hide()},1e3),$("body").hasClass("loading")&&$("body").removeClass("loading");break;case"showBtn":var r=e.show;switch(zpChat.showBtnStatus=r,parseInt(r)){case 1:zpChat.showBtn_1();break;case 2:zpChat.showBtn_2();break;case 3:case 5:zpChat.showBtn_3(r)}var d=e.isSend;isEmpty(d)||(zpChat.sendTextMessage({text:"患者结束诊疗",type:3},function(t){}),setTimeout(function(){s.swiper.update();var t=s.swiper.height,e=s.swiper.virtualSize;s.swiper.setWrapperTranslate(t-e)},400))}})});var o=this;$("footer.foot_inp textarea").on("focus",function(){setTimeout(function(){o.swiper.update();var t=o.swiper.height,e=o.swiper.virtualSize;o.swiper.setWrapperTranslate(t-e)},400)}),/iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase())&&($("footer.foot_inp textarea").on("focus",function(){setTimeout(function(){o.swiper.update();var t=o.swiper.height,e=o.swiper.virtualSize;o.swiper.setWrapperTranslate(t-e);var a=$("body").height()-t-$("header").height()-$(".aglinC").height()-$(".fs").height(),s=$("body").height()-t-$("header").height()-$(".aglinC").height()/2;$(".fs").css({position:"absolute",bottom:a}),$(".aglinC").css({position:"absolute",bottom:s})},400)}),$("footer.foot_inp textarea").on("blur",function(){$(".fs").css({position:"fixed",bottom:0}),$(".aglinC").css({position:"fixed",bottom:"0.85rem"})})),window.addEventListener("resize",function(){"INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName||window.setTimeout(function(){document.activeElement.scrollIntoViewIfNeeded()},0)});var n=$(".chat_body").find(".visible");setTimeout(function(){o.swiper=new Swiper(".swiper-container-list",{direction:"vertical",slidesPerView:"auto",observer:!0,observeParents:!0,mousewheelControl:!0,freeMode:!0,resistanceRatio:.7,onTouchEnd:function(t){t.height,t.virtualSize;if(t.translate>0){if(n.show(),o.statusOrder){var e=zpChat.getStorage();if(!isEmpty(e))return $api.pop("网络信号不好，请稍后再试"),!1;$(".visible").html("正在加载..."),$(".tips").hasClass("none")||$(".tips").addClass("none");var a=isEmpty(s.lists[0])?{}:o.lists[0];isEmpty(a.messageId)||zpChat.getHistoryMessages(a.messageId),setTimeout(function(){t.update()},800)}}else 0==t.translate&&n.hide()}})},400),window.addEventListener("popstate",function(t){$("textarea").blur()},!1),$("footer.foot_inp .btn").click(function(){if(!zpChat.isSendMsg)return $api.pop(zpChat.isSendMsgTip),!1;var t=$("footer.foot_inp textarea").val();if($api.isEmpty(t))$api.pop("没有输入内容");else{var e=zpChat.getStorage();if(!isEmpty(e))return $api.pop("网络信号不好，请稍后再试"),!1;zpChat.sendTextMessage({text:t},function(t){$("footer.foot_inp textarea").val("")})}})},methods:{video:function(){console.log("params="+i()(zpChat)),LBBVideo.openCall("doctor"+zpChat.doctor.uid,zpChat.doctor.name,zpChat.doctor.img)},scare:function(t){$(t.currentTarget).parent(".imgBox").toggleClass("active")},rePay:function(){this.$router.push({path:"/doctor/preOnline",query:{id:zpChat.toUser,subscribe_id:zpChat.subscribeId,subscribe_type:0}})},play:function(t){$(t.currentTarget).parent(".cont").children("audio")[0].play()},bg:function(t){if(t)return"background-image:url("+t+")"},sT:function(t){var e=this;return dateDiff(e.lists[t-1].time,e.lists[t].time)>.01},showCard:function(t){console.log("card:"+i()(this.lists[t]));var e=this.lists[t].extra;if(e.text,!1)return!1;this.lists[t].clinic_id;if(!isEmpty(e.cid)){var a=e.cType,s={},o="";switch(parseInt(a)){case 2:s={id:e.cid},o="/standard";break;case 1:case 4:o="/exam",s={id:e.id,clinic_id:e.clinic_id};break;case 3:o="/prescription/my/id",s={id:e.cid}}"/exam"==o?this.$store.state.tcmuser?this.$router.push({path:"/exam",query:{id:e.cid,listId:this.$route.query.listId,clinic_id:e.clinic_id}}):window.location.href="/wechat/exam?id="+e.cid+"&listId="+this.$route.query.listId+"&clinic_id="+e.clinic_id:this.$router.push({path:o,query:s})}},dateFormat:function(t){return new Date(t.replace(/-/g,"/")).Format("yyyy-MM-dd hh:mm:ss")},zw:function(){$(".jswz").addClass("none"),$(".fz").removeClass("none"),this.$http.get(this.$store.state.apiUrl+"message/statusBar/"+this.$route.query.listId+"?is_ask=1").then(function(t){}),zpChat.zw(),this.swiper.update(),this.$http.put(this.$store.state.apiUrl+"message/ask/"+this.$route.query.listId).then(function(t){t.data.status?($(".zw").addClass("none"),$(".foot_inp.fs").removeClass("none"),$(".inputImg").removeClass("none"),$(".jszw").removeClass("none")):$api.pop(t.data.msg)})},fz:function(){zpChat.fz(),this.swiper.update(),this.$router.push({path:"/doctor/preOnline",query:{id:zpChat.doctor.uid}})},fq:function(){zpChat.cancelPay(),this.swiper.update()},js:function(){$(".layer_pop").removeClass("none")},jszw:function(){$(".layer_pop").removeClass("none")},confirm:function(){if(!$(".jswz").hasClass("none")){var t=this;zpChat.endSick(),t.swiper.update(),$(".layer_pop").addClass("none"),this.$http({url:this.$store.state.apiUrl+"message/closeClinic/"+this.$route.query.listId,method:"put"}).then(function(e){$api.pop(e.data.msg),e.data.status?(zpChat.endSick(),t.swiper.update(),$(".layer_pop").addClass("none"),t.getChatStatus(t.$route.query.listId,t.$route.query.bespeakId),t.$router.push({path:"/order"})):$api.pop(e.data.msg)})}if(!$(".jszw").hasClass("none")){var t=this;zpChat.endSick(),t.swiper.update(),$(".layer_pop").addClass("none"),this.$http.post(this.$store.state.apiUrl+"message/endAsk",{id:this.$route.query.listId}).then(function(e){$api.pop(e.data.msg),e.data.status?(t.swiper.update(),$(".layer_pop").addClass("none"),t.getChatStatus(t.$route.query.listId,t.$route.query.bespeakId),t.$router.push({path:"/order"})):$api.pop(e.data.msg)})}},close:function(){this.swiper.update(),$(".layer_pop").addClass("none")},pay:function(){this.$http({url:this.$store.state.apiUrl+"clinic/again",method:"GET",params:{id:zpChat.clinicId,type:"clinic"}}).then(function(t){t.data.status?(zpChat.showBtn_1(),setTimeout(function(){this.$store.state.tcmuser?this.$router.push({path:"/payment",query:{id:t.data.data.order_sn,type:0}}):window.location.href="/wechat/payment/?id="+t.data.data.order_sn+"&type=0"},2e3)):$api.pop(t.data.msg)})},goOrder:function(){this.$router.push({path:"/order"})},imgScare:function(t){this.recipe_photo=t,$(".imgScare").show()},closeImg:function(){$(".imgScare").hide()},appUpload:function(){if(this.$store.state.tcmuser){var t=zpChat.getStorage();if(!isEmpty(t))return $api.pop("网络信号不好，请稍后再试"),!1;if(!zpChat.isSendMsg)return $api.pop(zpChat.isSendMsgTip),!1;var e=this;AppUpload(function(t){t&&t.status?zpChat.sendImgMessage({key:t.data.image_thumb_url,hash:t.data.image_url},function(t){setTimeout(function(){e.swiper.update();var t=e.swiper.height,a=e.swiper.virtualSize;e.swiper.setWrapperTranslate(t-a)},400)}):$api.pop("上传失败")},"upload/qiniu")}},upload:function(t){var e=zpChat.getStorage();if(!isEmpty(e))return $api.pop("网络信号不好，请稍后再试"),!1;if(!zpChat.isSendMsg)return $api.pop(zpChat.isSendMsgTip),!1;$("body").addClass("loading");var a=t.target;console.log(a);var s=new FormData;s.append("upload",1),s.append("image",a.files[0]);var i=this;this.$http.post(this.$store.state.apiUrl+"upload/qiniu",s).then(function(t){if(console.log(t),t.status){var e=t.data;console.log(e),e.status?zpChat.sendImgMessage({key:e.data.image_thumb_url,hash:e.data.image_url},function(t){setTimeout(function(){i.swiper.update();var t=i.swiper.height,e=i.swiper.virtualSize;i.swiper.setWrapperTranslate(t-e)},400)}):alert(e.msg),$("body").removeClass("loading")}})},getChatStatus:function(t,e){this.$http.get(this.$store.state.apiUrl+"message/statusBar/"+t+"?is_ask=0&bespeakId="+e).then(function(t){t.data.data.clinic?$(".jswz").removeClass("none"):$(".jswz").addClass("none"),1==t.data.data.ask?$(".zw").removeClass("none"):$(".zw").addClass("none"),1==t.data.data.end?$(".jszw").addClass("none"):2==t.data.data.end&&$(".jszw").removeClass("none"),t.data.data.clinic||!t.data.data.ask&&2==t.data.data.end?($("#inputImg").removeClass("none"),t.data.data.isVideo&&(this.isVideo=!0)):t.data.data.clinic||t.data.data.ask||1!=t.data.data.end?t.data.data.ask&&!t.data.data.clinic&&($("#inputImg").addClass("none"),this.isVideo=!1):($("#inputImg").addClass("none"),this.isVideo=!1),t.data.data.visit?$(".fz").removeClass("none"):$(".fz").addClass("none"),t.data.data.keyboard?$(".foot_inp.fs").removeClass("none"):$(".foot_inp.fs").addClass("none")},function(t){errorMsg(t.data.data.errors)})}}}},236:function(t,e){throw new Error('Module build failed: Error: D:\\coding\\tcm\\frontend\\src\\components\\template\\chat.vue:36\n    34|           .swiper-slide\r\n    35|               .visible 下拉加载\r\n  > 36| \t\t\t\t\r\n    37|               .chat_li(v-for="(item,index) in lists" v-bind:messagesId="item.messageId")\r\n    38|                   ///| {{item.messageId}}\r\n    39|                   .time(v-if="item.timeShow==1")  {{item.time}}\r\n\nInvalid indentation, you can use tabs or spaces but not both\n    at Lexer.indent (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\lexer.js:790:15)\n    at Lexer.next (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\lexer.js:941:15)\n    at Lexer.lookahead (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\lexer.js:113:46)\n    at Parser.lookahead (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:102:23)\n    at Parser.peek (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:79:17)\n    at Parser.tag (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:832:30)\n    at Parser.parseTag (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:759:17)\n    at Parser.parseExpr (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:211:21)\n    at Parser.parseExpr (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:252:21)\n    at Parser.block (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:729:25)\n    at Parser.tag (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:838:24)\n    at Parser.parseTag (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:759:17)\n    at Parser.parseExpr (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:211:21)\n    at Parser.parseExpr (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:252:21)\n    at Parser.block (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:729:25)\n    at Parser.tag (D:\\coding\\tcm\\frontend\\node_modules\\jade\\lib\\parser.js:838:24)')},97:function(t,e,a){var s=a(11)(a(148),a(236),null,null);t.exports=s.exports}});